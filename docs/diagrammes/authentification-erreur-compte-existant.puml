@startuml

skinparam backgroundColor white

actor "Conseiller ML" as conseiller
participant "i-Milo" as milo #CBC3E3
participant "Keycloak i-Milo" as kckMilo 	#CBC3E3
participant "CEJ" as cej #ADD8E6

header Page Header

title Erreur "compte existant" à la création d'un Jeune Milo sur le CEJ

autonumber
group Création du Jeune Milo sur le CEJ
skinparam sequenceMessageAlign right
conseiller -> cej : Création du compte CEJ Jeune : infos Jeune
skinparam sequenceMessageAlign left
cej -> cej : Check BDD\nJeune non existant

skinparam sequenceMessageAlign center
cej -> kckMilo :demande création de compte SSO Milo : idDossier
kckMilo -[#green]> kckMilo : Check aucun jeune lié au dossier\nOn lie Jeune ML au compte
kckMilo -> cej : succès : id-keycloak

skinparam sequenceMessageAlign left
cej -> cej : Enregistrement BDD\nid-keycloak\ninfos Jeune
end

group Reproduction de l'erreur
conseiller -> cej : Suppression du compte CEJ Jeune inactif
cej -> cej : Suppression BDD\ninfos Jeune
conseiller -> cej : Création du compte CEJ Jeune : infos Jeune
skinparam sequenceMessageAlign left
cej -> cej : Check BDD\nJeune non existant

skinparam sequenceMessageAlign center
cej -> kckMilo : demande création de compte SSO Milo : idDossier
kckMilo -[#green]> kckMilo : Un compte jeune\nest déjà lié au dossier
kckMilo -> cej : 400 SUE_RECORD_ALREADY_ATTACHED_TO_ACCOUNT
cej -> conseiller : Erreur : ce compte existe déjà
end
@enduml